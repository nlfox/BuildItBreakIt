In exploit 946_comment (31337), the attacker puts two comments on a single line. According to the spec, this is illegal since the second pair of slashes is considered part of the first comment, but our code parsed them separately. This casued our code to allow two comments on one line, but fail if a comment appeared before the authentication line. The whole way we handled newlines was very ad hoc and brittle. Some commands expected their own trailing newlines and others didn't, so to make this fix work accross the board, we had to completely overhaul the newline part of our parser.
