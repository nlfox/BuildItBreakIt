In exploit 946_comment (31337), the attacker puts two comments on a single line. According to the spec, this is illegal since the second pair of slashes is considered part of the first comment, but our code parsed them separately. This casued our code to allow two comments on one line, but fail if a comment appeared before the authentication line. It all boils down to how we expect newlines. Previously, we were expecting token / newline pairs, but we didn't account for comment / newline pairs. Since comments didn't include the trailing newline, the authentication line wouldn't match and the program would fail. By changing the sequence to look for comments at the end of every line, we solved all of these problems.
